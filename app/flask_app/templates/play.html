{% extends "layout.html" %}

{% block nav %}
<nav>
    <a href="/games" class="btn btn-outline-secondary">Games</a>
    <a href="/user/logout" class="btn btn-outline-secondary">Logout</a>
</nav>
{% endblock %}

{% block body %}

<div class="row">
    <div class="col mx-auto">
        
        {% if this_game.current_is_white %}
        <p>White: You</p>
        {% else %}
        <p>White: {{ this_game.current_opponent.full_name}}</p>
        {% endif %}
        
        <!-- display the current board -->
        {% for row in this_game.tiles_array_of_tuples %}
        {% set outer_loop = loop %}
        <div style="display:flex">
            {% for tile in row %}
            {% set inner_loop = loop %}

                {% if (outer_loop.index + inner_loop.index) % 2 == 1 %}
                <div class="tile light">
                {% else %}
                <div class="tile dark">
                {% endif %} 
                {% if tile[0] %}
                {{ tile[2] }}
                {% endif %}
                </div>

            {% endfor %}
        </div>
        {% endfor %}
        
        <div class="mt-3">
            {% if this_game.current_is_white %}
            <p>Black: {{ this_game.current_opponent.full_name}}</p>
            {% else %}
            <p>Black: You</p>
            {% endif %}
        </div>
        
        <!-- display move number, and check or check-mate -->
        <p class="mt-3">Move {{ move_nr }}.   
            {% if this_game.status == 2 %} <b>Check</b>
            {% elif this_game.status == 3 %} <b>Draw offered</b>
            {% elif this_game.status == 4 %} <b>Draw</b>
            {% elif this_game.status == 5 %} <b>Resigned</b>
            {% elif this_game.status == 6 %} <b>Check mate</b>
            {% endif %}
        </p>
        
        <!-- active games have status: 1, 2, 3  -->
        {% if this_game.status < 4 %}
            {% if (this_game.current_is_white and this_game.number_of_moves % 2 == 0) or (not this_game.current_is_white and this_game.number_of_moves % 2 == 1) %}
            
                <p>It is your turn</p>
                <form action="/games/move" method="post">
                    Your move:
                    <input type="text" name="your_move">
                    <input type="submit" value="Submit">
                    <input type="hidden" name="game_id" value={{ this_game.id }}>
                </form>          

            {% else %}
                <p class="mt-3">It is {{ this_game.current_opponent.first_name }}'s turn</p>
            {% endif %}
        {% endif %}
    </div>
</div>

{% endblock %}